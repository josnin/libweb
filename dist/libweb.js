var A=async(...i)=>{let[e,t,n,s]=i,r=t.getAttribute("*if");r&&!e[r]&&!e.__reactive[r]&&(t.removeAttribute("*if"),t.dataset.if="",t.style.display="none")};var _=async(...i)=>{let[e,t,n,s]=i,r=t.getAttribute("data-bind");t.type==="text"&&r?t.oninput=a=>{e.__reactive[r]=a.target.value}:t.type==="text"&&t.dataset.bind===n&&(t.value=s)};var P=i=>i[0].replace(/[()]/g,""),v=(i,e,t)=>i.replace(e,"").replace(t,"").trim();var p=(i,e)=>{let t;return i[e]!=null?t=i[e]:i.__reactive[e]!=null?t=i.__reactive[e]:t=e,t};var j=async(i,e)=>{e.dataset.event&&(e[`on${e.dataset.event}`]=async t=>{try{let n=[];await e.dataset.args.split(",").forEach(r=>{let a=p(i,r.trim());a&&n.push(`'${a}'`)});let s=`${e.dataset.fn}(${n.join()})`;Function(`this.self.${s.replaceAll("'$event'","this.$event")}`).call({self:i,$event:t})}catch{Function(`${e.value.replaceAll("'$event'","this.$event")}`).call({$event:t})}})};var M=(...i)=>{let[e]=i,[t,n]=e.split("of"),s,r;return t.match(/\(.+\)/)?.length>0?[r,s]=P(t.match(/\(.+\)/)).split(","):s=t,n=n.trim(),s=s?s.trim():"",{items:n,alias:s,index:r}},I=(...i)=>{let[e,t,n,s,r]=i;n==0&&!s?(t.dataset.begin=!0,s=t.dataset.begin):e.length-1===n&&!r&&(t.dataset.end=!0,r=t.dataset.end)},E=(...i)=>{let[e,t,n]=i,{alias:s,index:r,for:a}=t.dataset,o=!1,c=!1,f=p(e,a);for(let[u,x]of Object.entries(f)){let h=t.cloneNode(!0),y={};for(let l of h.childNodes)if(l.dataset?.var)if(l.dataset.var.match(/\./)?.length===1){let[H,w]=l.dataset.var.split(".");s===H&&(y[s]=x,y[s][w]&&(l.textContent=y[s][w]))}else s===l.dataset.var?x&&(l.textContent=x):r===l.dataset.var&&u&&(l.textContent=u);h.dataset.uniq=n,I(f,h,u,o,c),t.parentNode?.insertBefore(h,t)}},D=(...i)=>{let[e,t]=i,{for:n,alias:s}=e.dataset;e.parentNode?.childNodes&&Array.from(e.parentNode.childNodes).map(r=>{r.dataset?.begin||r.dataset?.uniq&&r.dataset.uniq!==t&&r.dataset?.for&&r.dataset.for===n&&r.dataset.alias===s&&r.remove()})},R=async(i,e,t,n)=>{let s=e.getAttribute("*For");if(s){let r=(+new Date).toString(36),{index:a,alias:o,items:c}=M(s);e.dataset.uniq="l2rkqnta__",e.dataset.for=c,e.dataset.alias=o,e.dataset.index=a,e.removeAttribute("*For"),E(i,e,r),D(e,r,c,o)}else if(e.dataset?.for&&e.dataset?.begin&&e.dataset.for===t){let r=(+new Date).toString(36);delete e.dataset.begin,delete e.dataset.end,E(i,e,r),D(e,r)}};var V=(...i)=>{let[e]=i;for(let t of e.childNodes)t.dataset?.var&&(t.dataset?.pipe?t.textContent=`{${t.dataset.var} | ${t.dataset.pipe}}`:t.textContent=`{${t.dataset.var}}`)},$=async(...i)=>{let[e,t,n,s]=i;t.getAttribute("nobind")!=null?(t.removeAttribute("nobind"),t.dataset.nobind="",V(t)):t.dataset?.nobind!=null&&V(t)};var C=async(i,e)=>e==="json"?JSON.stringify(i):i;var m=class{constructor(...e){this.register=[C],this.args=e}apply(){let[e,t]=this.args,n;if(t){n=e;for(let s of this.register)n=s(n,t)}return n}};var N=async(...i)=>{let[e,t,n,s]=i;if(t.dataset.var!==void 0&&t.dataset.var===n){let r=s;if(t.dataset.pipe){let a=t.dataset.pipe;r=await new m(r,a).apply()}t.textContent=r}};var g=class{constructor(...e){this.register=[N,A,_,j,R,$],this.args=e}async apply(){let[e,t,n]=this.args;for(let s of this.register)for(let r of e.shadowRoot.querySelectorAll("*"))await s(e,r,t,n)}};var d={ATTR_PREFIX:"__",ATTR_REPLACE:"on",VAR_PARSE:{start:"{",end:"}"}};var S=async(...i)=>{let[e,t]=i,n=t.textContent?.match(/{[^{^}^\|]*}/gi);if(!!n){for(let s of n)if(s=s.trim(),s){let r=v(s,d.VAR_PARSE.start,d.VAR_PARSE.end),a=p(e,r);a&&(t.innerHTML=t.innerHTML.replaceAll(s,`<lib-w data-var=${r}>${a}</lib-w>`))}}};var T=async(...i)=>{let[e,t]=i,n=t.textContent?.match(/\{[^{^}\n\r]*\|[^{^}\n\r]*\}/gi);if(!!n){for(let s of n)if(s=s.trim(),s){let r=v(s,d.VAR_PARSE.start,d.VAR_PARSE.end),a=r.split("|").length>1,o=r.split("|")[0].trim(),c=p(e,o);if(c&&a){let f=r.split("|")[1].trim();c=await new m(c,f).apply(),t.innerHTML=t.innerHTML.replaceAll(s,`<lib-w data-var=${o} data-pipe=${f}>${c}</lib-w>`)}}}};var q=async(...i)=>{let[e,t]=i;for(let[n,s]of Object.entries(t.attributes))s.name.startsWith("@")&&(t.dataset.event=s.name.split("@")[1],t.dataset.fn=s.value.split("(")[0],t.dataset.args=s.value.split("(")[1].split(")")[0],t.removeAttribute(s.name))};var b=class{constructor(...e){this.register=[S,T,q],this.args=e}async apply(){let[e,t]=this.args;for(let n of this.register)for(let s of t.querySelectorAll("*"))await n(e,s)}};var L=class extends HTMLElement{};customElements.define("lib-w",L);var B=class{constructor(e,t){this.prependStyle=()=>{let n=document.createElement("style");n.textContent=this.self.__styles,this.fragment.prepend(n)},this.createTplFragment=n=>{this.fragment=new DocumentFragment;let s=document.createElement("lib-w"),r=document.createElement("template");r.innerHTML=n,this.fragment.appendChild(s),this.fragment.querySelector("lib-w")?.appendChild(r.content.cloneNode(!0))},this.runParserAndDirectives=async()=>{await new b(this.self,this.fragment).apply(),this.prependStyle(),this.self.shadowRoot.appendChild(this.fragment),await new g(this.self,"","").apply()},this.makeReactive=n=>{let s={get:(r,a)=>typeof r[a]=="object"&&r[a]!==null?new Proxy(r[a],s):r[a],set:(r,a,o)=>(new g(this.self,a,o).apply(),r[a]=o,!0)};return new Proxy(n,s)},this.self=e,this.self.attachShadow({mode:"open"}),this.createTplFragment(t),this.runParserAndDirectives(),this.self.__reactive=this.makeReactive(this.self.__reactive)}},F=class extends HTMLElement{constructor(){super();this.__reactive={}}connectedCallback(){let e=new B(this,this.__template)}};globalThis.LWElement=F;export{F as LWElement,B as LibWeb};
//# sourceMappingURL=libweb.js.map
